# Requirements Document
# SIFT Image Stitching Tool - 要件定義書

**Version**: 1.0.0  
**Created**: 2025-12-12  
**Status**: Draft  
**Feature Branch**: `001-sift-image-stitching`

---

## 1. Introduction

### 1.1 概要

本ドキュメントは、SIFT特徴点マッチングを用いた画像合成ツール「SIFT Image Stitching Tool」の要件を定義する。サービスデザイナーがワークショップの成果物を高解像度画像として記録・共有するためのツールである。

### 1.2 背景と目的

#### なぜこのツールが必要か

サービスデザイナーがサービス構想を検討する際、ユーザージャーニーマップなどをワークショップ形式で議論することが多い。その際、大判印刷したフレームを壁に貼り、付箋を使いながら広い面積で議論を行う。

**現状の課題:**
- ワークショップの成果を写真で記録する際、1枚の広角写真では付箋に書かれた文字を読み取ることができない
- 複数の画像を1つ1つ閲覧して振り返りを行っており、全体像と詳細を同時に把握できない
- Photoshopなどでの手動合成は手間がかかるため、実施されることが少ない

**解決策:**
広角で撮影した全体写真と、クローズアップで撮影した詳細写真を自動合成し、全体像と詳細の両方を確認できる高解像度画像を生成する。

### 1.3 成功指標（KPI）

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| 作業時間削減 | 従来比50%以上削減 | ユーザーヒアリング |
| 合成成功率 | 80%以上の画像が正常合成 | システムログ |
| ユーザー満足度 | 使いやすさ評価4/5以上 | アンケート |

### 1.4 スコープ

#### In Scope（対象範囲）
- 静止画像（JPEG/PNG）の合成処理
- Windows PC向けデスクトップアプリケーション
- ローカル環境での実行
- 日本語UI

#### Out of Scope（対象外）
- 動画処理
- モバイルアプリ
- クラウドサービスとしての提供
- 多言語対応（初期リリース）

---

## 2. Personas（ペルソナ）

### 2.1 Primary Persona: サービスデザイナー

| 属性 | 詳細 |
|------|------|
| **名前** | 田中 美咲（仮名） |
| **役職** | サービスデザイナー |
| **年齢** | 30代 |
| **技術レベル** | 非技術者（プログラミング経験なし） |
| **使用デバイス** | Windows PC（会社支給）、iPhone（撮影用） |
| **利用頻度** | 月に数回（ワークショップ実施時） |
| **ITスキル** | Office製品は問題なく使用可能、コマンドライン操作は不慣れ |

#### ペインポイント（課題）
- ワークショップの成果を効率的に記録・共有したい
- 付箋の内容を後から確認できる形で保存したい
- 技術的な知識なしで簡単に使えるツールが欲しい
- 手動での画像編集に時間をかけたくない

#### ゴール
- ワークショップ終了後、短時間で成果物を記録できる
- チームメンバーと高品質な記録を共有できる
- 振り返り時に全体像と詳細の両方を確認できる

---

## 3. User Stories（ユーザーストーリー）

### 3.1 コア機能

#### US-001: 画像アップロード
**As a** サービスデザイナー  
**I want to** 広角画像1枚とクローズアップ画像複数枚をアップロードしたい  
**So that** 合成処理の準備ができる

**Acceptance Criteria (EARS Notation):**
- WHEN ユーザーが広角画像を選択した場合 THE SYSTEM SHALL その画像をOverview画像として登録する
- WHEN ユーザーがクローズアップ画像を複数選択した場合 THE SYSTEM SHALL それらをCloseup画像として登録する
- WHEN 対応していないファイル形式がアップロードされた場合 THE SYSTEM SHALL エラーメッセージを表示し、対応形式（JPEG/PNG）を案内する
- THE SYSTEM SHALL 1回の処理で10〜30枚のクローズアップ画像を受け付ける

#### US-002: 自動画像合成
**As a** サービスデザイナー  
**I want to** アップロードした画像を自動で合成したい  
**So that** 手動編集なしで高解像度画像を取得できる

**Acceptance Criteria (EARS Notation):**
- WHEN ユーザーが合成開始ボタンをクリックした場合 THE SYSTEM SHALL SIFT特徴点マッチングによる自動合成処理を開始する
- WHILE 合成処理が実行中の場合 THE SYSTEM SHALL 進捗状況をリアルタイムで表示する
- WHEN 合成処理が完了した場合 THE SYSTEM SHALL 結果画像をダウンロード可能な状態にする
- WHEN 10枚のクローズアップ画像を処理する場合 THE SYSTEM SHALL 5分以内に処理を完了する

#### US-003: 部分的失敗時の継続処理
**As a** サービスデザイナー  
**I want to** 一部の画像が合成に失敗しても、成功した分だけで結果を得たい  
**So that** 完璧でなくても実用的な結果を取得できる

**Acceptance Criteria (EARS Notation):**
- IF 一部のクローズアップ画像の合成が失敗した場合 THE SYSTEM SHALL 失敗画像を除外し、成功分のみで合成を完了する
- WHEN 合成処理が完了した場合 THE SYSTEM SHALL 成功数と失敗数をサマリーとして表示する
- WHEN 失敗画像がある場合 THE SYSTEM SHALL 失敗したファイル名と理由をログに記録する

#### US-004: 品質警告表示
**As a** サービスデザイナー  
**I want to** 合成品質が低い場合に警告を受けたい  
**So that** 必要に応じて再撮影や手動調整の判断ができる

**Acceptance Criteria (EARS Notation):**
- WHEN 合成処理が完了した場合 THE SYSTEM SHALL 品質スコア（成功率、インライア率等）を表示する
- IF 品質スコアが閾値を下回った場合 THE SYSTEM SHALL 警告メッセージを表示する
- WHEN 警告が表示された場合 THE SYSTEM SHALL 品質改善のためのヒント（撮影時のオーバーラップ推奨等）を案内する

#### US-005: 結果画像のダウンロード
**As a** サービスデザイナー  
**I want to** 合成結果をファイルとしてダウンロードしたい  
**So that** プレゼン資料への貼り付けやアーカイブができる

**Acceptance Criteria (EARS Notation):**
- WHEN 合成処理が完了した場合 THE SYSTEM SHALL 結果画像をPNG形式で出力する
- WHEN 結果画像を保存する場合 THE SYSTEM SHALL ファイル名を日時ベースで自動生成する（例: stitched_20251212_143052.png）
- THE SYSTEM SHALL 出力画像のファイルサイズに上限を設けない

### 3.2 提供形態

#### US-006: Web UI での操作
**As a** サービスデザイナー  
**I want to** ブラウザベースのUIで操作したい  
**So that** 直感的に操作でき、インストール不要で使用開始できる

**Acceptance Criteria (EARS Notation):**
- WHEN ユーザーがアプリケーションを起動した場合 THE SYSTEM SHALL ローカルホスト上でWebサーバーを起動し、ブラウザでUIを表示する
- THE SYSTEM SHALL ドラッグ＆ドロップによる画像アップロードに対応する
- THE SYSTEM SHALL 日本語のUIを提供する
- THE SYSTEM SHALL マウス操作のみで全ての基本機能を実行可能にする

#### US-007: EXE形式での配布
**As a** サービスデザイナー  
**I want to** インストーラー不要のEXEファイルとして使用したい  
**So that** 社内ポータルからダウンロードしてすぐに使用開始できる

**Acceptance Criteria (EARS Notation):**
- THE SYSTEM SHALL 単一のEXEファイルとして配布可能な形式で提供する
- WHEN ユーザーがEXEファイルを実行した場合 THE SYSTEM SHALL 追加のインストール作業なしで起動する
- WHEN EXEファイルが起動した場合 THE SYSTEM SHALL 自動的にデフォルトブラウザでWeb UIを開く
- THE SYSTEM SHALL Windows 10以降で動作する

#### US-008: CLI での実行（開発者・上級者向け）
**As a** 開発者/上級ユーザー  
**I want to** コマンドラインから実行したい  
**So that** スクリプト化や自動化ができる

**Acceptance Criteria (EARS Notation):**
- WHEN ユーザーがCLIコマンドを実行した場合 THE SYSTEM SHALL 指定されたディレクトリの画像を処理する
- THE SYSTEM SHALL 処理ログをコンソールおよびログファイルに出力する
- THE SYSTEM SHALL コマンドライン引数でパラメータを指定可能にする

### 3.3 補助機能

#### US-009: 処理の中断
**As a** サービスデザイナー  
**I want to** 処理中にキャンセルできるようにしたい  
**So that** 誤った画像をアップロードした場合にやり直せる

**Acceptance Criteria (EARS Notation):**
- WHILE 合成処理が実行中の場合 THE SYSTEM SHALL キャンセルボタンを表示する
- WHEN ユーザーがキャンセルボタンをクリックした場合 THE SYSTEM SHALL 処理を中断し、初期状態に戻る
- WHEN 処理がキャンセルされた場合 THE SYSTEM SHALL 一時ファイルを削除する

#### US-010: 処理ログの確認
**As a** サービスデザイナー  
**I want to** 処理の詳細ログを確認したい  
**So that** 問題発生時に原因を特定できる

**Acceptance Criteria (EARS Notation):**
- THE SYSTEM SHALL 処理ログをファイルに保存する
- WHEN ユーザーがログ表示を要求した場合 THE SYSTEM SHALL 処理結果の詳細（成功/失敗ファイル一覧、処理時間等）を表示する

---

## 4. Functional Requirements（機能要件）

### 4.1 必須機能（P0: Must Have）

| ID | 機能名 | 説明 | 関連US |
|----|--------|------|--------|
| FR-001 | 画像アップロード | 広角画像1枚とクローズアップ画像（10-30枚）のアップロード | US-001 |
| FR-002 | SIFT特徴点マッチング | SIFT アルゴリズムによる画像間の対応点検出 | US-002 |
| FR-003 | ホモグラフィ推定 | RANSACを用いた幾何変換行列の計算 | US-002 |
| FR-004 | 画像ブレンディング | ガウシアンブラーマスクによる滑らかな境界処理 | US-002 |
| FR-005 | 進捗表示 | リアルタイムの処理進捗表示 | US-002 |
| FR-006 | 結果出力 | PNG形式での合成画像出力 | US-005 |
| FR-007 | Web UI | ブラウザベースのユーザーインターフェース | US-006 |
| FR-008 | EXE配布 | スタンドアロン実行ファイル | US-007 |
| FR-009 | CLI実行 | コマンドラインインターフェース | US-008 |
| FR-010 | 部分失敗時継続 | 失敗画像をスキップして処理継続 | US-003 |
| FR-011 | 処理サマリー | 成功/失敗数の表示 | US-003 |

### 4.2 重要機能（P1: Should Have）

| ID | 機能名 | 説明 | 関連US |
|----|--------|------|--------|
| FR-012 | 品質スコア表示 | 合成品質の数値表示と警告 | US-004 |
| FR-013 | 処理中断 | キャンセル機能 | US-009 |
| FR-014 | REST API | Web UIとバックエンドの通信 | US-006 |
| FR-015 | 処理ログ保存 | ログファイルへの記録 | US-010 |

### 4.3 将来機能（P2: Nice to Have）

| ID | 機能名 | 説明 | 関連US |
|----|--------|------|--------|
| FR-016 | バッチ処理 | 複数セットの一括処理 | - |
| FR-017 | 処理再開 | 中断した処理の再開 | US-009 |
| FR-018 | プレビュー | 合成前のプレビュー表示 | - |
| FR-019 | プリセット保存 | パラメータ設定の保存 | - |
| FR-020 | 処理履歴 | 過去の処理履歴管理 | - |

---

## 5. Non-Functional Requirements（非機能要件）

### 5.1 性能要件

| ID | 要件 | 目標値 | 優先度 |
|----|------|--------|--------|
| NFR-001 | 処理速度（10枚） | 5分以内 | P0 |
| NFR-002 | 処理速度（30枚） | 15分以内 | P1 |
| NFR-003 | メモリ使用量 | 8GB RAM環境で動作 | P0 |
| NFR-004 | 起動時間 | 30秒以内 | P1 |

### 5.2 ユーザビリティ要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| NFR-005 | 操作性 | マウス操作のみで全機能利用可能 | P0 |
| NFR-006 | 学習コスト | 初回利用時5分以内で基本操作習得可能 | P0 |
| NFR-007 | UI言語 | 日本語 | P0 |
| NFR-008 | エラーメッセージ | 日本語で具体的な対処方法を提示 | P0 |

### 5.3 互換性要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| NFR-009 | OS | Windows 10 以降 | P0 |
| NFR-010 | ブラウザ | Chrome, Edge（最新版） | P0 |
| NFR-011 | 入力形式 | JPEG, PNG | P0 |
| NFR-012 | 入力解像度 | iPhone広角カメラ出力（4032×3024等） | P0 |

### 5.4 信頼性要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| NFR-013 | 合成成功率 | 80%以上の画像が正常合成 | P0 |
| NFR-014 | エラー復旧 | 部分失敗時も処理継続 | P0 |
| NFR-015 | データ保全 | 入力画像を変更・削除しない | P0 |

### 5.5 保守性要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| NFR-016 | ログ出力 | 処理詳細をログファイルに記録 | P0 |
| NFR-017 | ライセンス | オープンソース/商用利用可能なライブラリのみ使用 | P0 |
| NFR-018 | 単独保守 | 1名で保守可能な構成 | P1 |

---

## 6. Constraints & Assumptions（制約と前提条件）

### 6.1 制約事項

| ID | 種別 | 内容 |
|----|------|------|
| CON-001 | 技術 | オープンソースまたは商用利用可能なライブラリのみ使用 |
| CON-002 | 技術 | 有償ライブラリは使用不可 |
| CON-003 | 環境 | Windows PC（会社支給）での動作を前提 |
| CON-004 | 環境 | ローカル実行（インターネット接続不要） |
| CON-005 | 運用 | 開発者1名による単独保守 |
| CON-006 | 運用 | ユーザー数は2-5名（チーム内利用） |

### 6.2 前提条件

| ID | 内容 |
|----|------|
| ASM-001 | 広角画像1枚に対して、クローズアップ画像は広角画像の一部を拡大撮影したものである |
| ASM-002 | クローズアップ画像間には多少の重なり（オーバーラップ）がある |
| ASM-003 | 撮影はiPhoneで行われ、OneDrive経由でPCに転送される |
| ASM-004 | 撮影環境（照明、壁の色、付箋の色）は様々である |
| ASM-005 | ユーザーはコマンドライン操作に不慣れである |
| ASM-006 | サポートは開発者による直接対応およびドキュメント/FAQで行う |

### 6.3 依存関係

| ID | 依存先 | 内容 |
|----|--------|------|
| DEP-001 | OpenCV | SIFT特徴点検出、ホモグラフィ計算 |
| DEP-002 | Python | 実行環境（3.11以上） |
| DEP-003 | Flask | Webサーバー |
| DEP-004 | PyInstaller | EXEビルド |

---

## 7. User Workflow（ユーザーワークフロー）

### 7.1 典型的な利用フロー

```
┌─────────────────────────────────────────────────────────────────────┐
│                    ワークショップ実施                                │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐            │
│  │ 壁に大判    │    │ 付箋で議論  │    │ 成果物完成  │            │
│  │ フレーム貼付│───►│ ・意見出し  │───►│             │            │
│  │             │    │ ・整理      │    │             │            │
│  └─────────────┘    └─────────────┘    └─────────────┘            │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    写真撮影（iPhone）                                │
│  ┌─────────────┐    ┌─────────────────────────────────────┐       │
│  │ 広角で全体  │    │ クローズアップで詳細（10-30枚）     │       │
│  │ を1枚撮影   │    │ ・付箋が読める解像度                │       │
│  │             │    │ ・重要部分を中心に撮影              │       │
│  └─────────────┘    └─────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    画像転送（OneDrive）                              │
│  iPhone ────► OneDrive ────► Windows PC                            │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    本ツールで合成                                    │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐            │
│  │ EXE起動     │    │ 画像を      │    │ 合成開始    │            │
│  │ (ダブル     │───►│ ドラッグ&   │───►│ ボタン      │            │
│  │  クリック)  │    │ ドロップ    │    │ クリック    │            │
│  └─────────────┘    └─────────────┘    └─────────────┘            │
│                                               │                     │
│                                               ▼                     │
│                           ┌─────────────────────────────┐          │
│                           │ 進捗表示（リアルタイム）    │          │
│                           │ ・処理中の画像名            │          │
│                           │ ・進捗バー                  │          │
│                           └─────────────────────────────┘          │
│                                               │                     │
│                                               ▼                     │
│                           ┌─────────────────────────────┐          │
│                           │ 結果表示                    │          │
│                           │ ・成功/失敗サマリー         │          │
│                           │ ・品質スコア                │          │
│                           │ ・ダウンロードボタン        │          │
│                           └─────────────────────────────┘          │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    成果物活用                                        │
│  ┌─────────────────────┐    ┌─────────────────────┐                │
│  │ PC画面で拡大縮小    │    │ プレゼン資料に      │                │
│  │ しながら振り返り    │    │ 貼り付けて共有      │                │
│  └─────────────────────┘    └─────────────────────┘                │
└─────────────────────────────────────────────────────────────────────┘
```

### 7.2 エラー時のフロー

```
┌─────────────────────────────────────────────────────────────────────┐
│  合成処理中にエラー発生                                              │
│                                                                     │
│  ┌─────────────┐    ┌─────────────────────────────────────┐       │
│  │ 一部画像の  │───►│ 失敗画像をスキップして処理継続      │       │
│  │ 合成失敗    │    │                                     │       │
│  └─────────────┘    └─────────────────────────────────────┘       │
│                                    │                                │
│                                    ▼                                │
│                     ┌─────────────────────────────────────┐       │
│                     │ 結果表示                            │       │
│                     │ ・成功: 25枚 / 失敗: 5枚            │       │
│                     │ ・失敗ファイル一覧                  │       │
│                     │ ・失敗理由（特徴点不足等）          │       │
│                     │ ・品質改善のヒント表示              │       │
│                     └─────────────────────────────────────┘       │
│                                    │                                │
│                                    ▼                                │
│                     ┌─────────────────────────────────────┐       │
│                     │ ユーザー判断                        │       │
│                     │ ・結果をそのまま使用                │       │
│                     │ ・再撮影して再実行                  │       │
│                     └─────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 8. Future Considerations（将来の拡張）

### 8.1 計画済み拡張（Phase 2以降）

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| FUT-001 | OCR機能 | 付箋テキストの自動読み取り | 高 |
| FUT-002 | バッチ処理 | 複数セットの一括処理 | 中 |
| FUT-003 | 処理履歴 | 過去の処理結果の管理 | 低 |

### 8.2 検討中の拡張

| ID | 機能 | 説明 |
|----|------|------|
| FUT-004 | Mac対応 | macOS向けアプリケーション |
| FUT-005 | クラウド版 | Webサービスとしての提供 |
| FUT-006 | AI要約 | 合成画像からの内容要約生成 |

---

## 9. Glossary（用語集）

| 用語 | 説明 |
|------|------|
| Overview画像 | 全体を広角で撮影した1枚の画像 |
| Closeup画像 | 詳細部分を拡大撮影した画像（複数枚） |
| SIFT | Scale-Invariant Feature Transform。スケールや回転に不変な特徴点検出アルゴリズム |
| ホモグラフィ | 2つの平面間の射影変換を表す3x3行列 |
| RANSAC | Random Sample Consensus。外れ値に頑健なパラメータ推定アルゴリズム |
| オーバーラップ | 隣接する画像間で重複している領域 |
| インライア率 | RANSACで推定されたモデルに適合するデータ点の割合 |

---

## 10. Revision History（改訂履歴）

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0.0 | 2025-12-12 | - | 初版作成 |

---

## 11. Sign-off（承認）

| Role | Name | Date | Status |
|------|------|------|--------|
| Product Owner | | | Pending |
| Tech Lead | | | Pending |
| Stakeholder | | | Pending |
